<!DOCTYPE html>
<html lang="en">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Agentic AI with Pydantic-AI Part 1. - Han&#39;s XYZ</title><meta name="Description" content="A tutorial for Pydantic-AI"><meta property="og:url" content="http://localhost:1313/pydantic-ai/">
  <meta property="og:site_name" content="Han&#39;s XYZ">
  <meta property="og:title" content="Agentic AI with Pydantic-AI Part 1.">
  <meta property="og:description" content="A tutorial for Pydantic-AI">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-08-31T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-09-02T17:53:13+09:00">
    <meta property="article:tag" content="Python">
    <meta property="article:tag" content="Pydantic">
    <meta property="article:tag" content="Pydantic-AI">
    <meta property="article:tag" content="Agent">
    <meta property="article:tag" content="AI">
    <meta property="og:image" content="http://localhost:1313/logo.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:1313/logo.png">
  <meta name="twitter:title" content="Agentic AI with Pydantic-AI Part 1.">
  <meta name="twitter:description" content="A tutorial for Pydantic-AI">
<meta name="application-name" content="KeepIt">
<meta name="apple-mobile-web-app-title" content="KeepIt">
<meta name="referrer" content="no-referrer" /><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://localhost:1313/pydantic-ai/" /><link rel="prev" href="http://localhost:1313/pydantic/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/css/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><meta name="google-site-verification" content="B7mVm-DfAgGVs4ghQkEqrmeZIv8D26A-1C7dx6Ajeh0" /><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Agentic AI with Pydantic-AI Part 1.",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/localhost:1313\/pydantic-ai\/"
        },"genre": "posts","keywords": "Python, Pydantic, Pydantic-AI, Agent, AI","wordcount":  2263 ,
        "url": "http:\/\/localhost:1313\/pydantic-ai\/","datePublished": "2025-08-31T00:00:00+00:00","dateModified": "2025-09-02T17:53:13+09:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Han"
            },"description": "A tutorial for Pydantic-AI"
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script>(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Han&#39;s XYZ"><span class="header-title-pre"><i class='fa fa-home ' aria-hidden='true'></i></span>Han&#39;s XYZ</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="https://github.com/Han8931" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Han&#39;s XYZ"><span class="header-title-pre"><i class='fa fa-home ' aria-hidden='true'></i></span>Han&#39;s XYZ</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="https://github.com/Han8931" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Agentic AI with Pydantic-AI Part 1.</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Han</a></span>&nbsp;<span class="post-category">included in <a href="/categories/python/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Python</a>&nbsp;<a href="/categories/pydantic-ai/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Pydantic AI</a>&nbsp;<a href="/categories/ai/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>AI</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2025-08-31">2025-08-31</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;2263 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;11 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#a-minimal-example">A Minimal Example</a></li>
    <li><a href="#building-a-structured-agent">Building a Structured Agent</a>
      <ul>
        <li><a href="#step-1-define-the-schema">Step 1: Define the Schema</a></li>
        <li><a href="#step-2-configure-the-model">Step 2: Configure the Model</a></li>
        <li><a href="#step-3-create-the-agent">Step 3: Create the Agent</a></li>
        <li><a href="#step-4-run-the-agent">Step 4: Run the Agent</a></li>
      </ul>
    </li>
    <li><a href="#introducing-tools">Introducing Tools</a>
      <ul>
        <li><a href="#breaking-it-down">Breaking It Down</a></li>
        <li><a href="#why-tools-matter">Why Tools Matter</a></li>
      </ul>
    </li>
    <li><a href="#sre-example">SRE Example</a>
      <ul>
        <li>
          <ul>
            <li><a href="#dependencies-injection">Dependencies Injection</a></li>
            <li><a href="#agent-definition">Agent definition</a></li>
            <li><a href="#dynamic-system-prompt-injection">Dynamic system prompt injection</a></li>
            <li><a href="#tools">Tools</a></li>
            <li><a href="#running-the-agent">Running the agent</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#references">References</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="introduction">Introduction</h2>
<p>AI has already changed how we interact with technology. The real shift is happening now with <strong>agents</strong>: AI systems that can reason, make decisions, and take action.</p>
<p>Unlike a chatbot that passively replies, an agent can <strong>break down complex tasks</strong>, call APIs or databases, use tools, and deliver structured results. This is what makes the idea of <em>Agentic AI</em> so powerful — it&rsquo;s not just about conversation, it&rsquo;s about <strong>problem-solving with initiative</strong>.</p>
<p>So far, <strong>LangGraph</strong> has emerged as the <em>de-facto</em> approach for building complex, stateful agents. But there&rsquo;s also a growing need for something simpler, more ergonomic — and that&rsquo;s where <strong><a href="https://github.com/pydantic/pydantic-ai" target="_blank" rel="noopener noreffer ">Pydantic AI</a></strong> comes in.</p>
<p>Pydantic AI is a <strong>Python agent framework</strong> designed to make it <em>less painful to build production-grade applications with Generative AI</em>. Just as <strong>FastAPI</strong> revolutionized web development with an ergonomic design built on <strong>Pydantic validation</strong>, Pydantic AI brings that same &ldquo;FastAPI feeling&rdquo; to GenAI app development.</p>
<p>Developers can apply the same best type-safe and Python-centric practices they have used in any other project. Structured responses are validated through Pydantic, dependencies can be injected directly into prompts and tools and for complex scenarios, Pydantic Graph provides a clean way to define control flow without descending into spaghetti code.</p>
<p>In this post — the first in a short series — we&rsquo;ll explore the <strong>basics of Agentic AI and Pydantic AI</strong>, why they matter, and how they&rsquo;re shaping the way we build intelligent systems.</p>
<hr>
<h2 id="a-minimal-example">A Minimal Example</h2>
<p>Set up with <code>uv</code>:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-sh">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">uv init pydantic_ai_tutorial
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> pydantic_ai_tutorial
</span></span><span class="line"><span class="cl">uv add pydantic pydantic-ai python-dotenv</span></span></code></pre></div></div>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-python">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pydantic_ai</span> <span class="kn">import</span> <span class="n">Agent</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>  
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;google-gla:gemini-1.5-flash&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">system_prompt</span><span class="o">=</span><span class="s1">&#39;Be concise, reply with one sentence.&#39;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="s1">&#39;Where does &#34;hello world&#34; come from?&#39;</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># The first known use of &#34;hello, world&#34; was in a 1974 textbook about the C programming language.</span></span></span></code></pre></div></div>
<p>Here, Pydantic AI sends both the <strong>system prompt</strong> and the <strong>user query</strong> to the LLM. The model then returns a plain text response.</p>
<p>That&rsquo;s a good start — but real agents often need more than text. Let&rsquo;s build something more powerful.</p>
<hr>
<h2 id="building-a-structured-agent">Building a Structured Agent</h2>
<p>We start by importing the essentials:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-python">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pydantic_ai</span> <span class="kn">import</span> <span class="n">Agent</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pydantic_ai.models.openai</span> <span class="kn">import</span> <span class="n">OpenAIChatModel</span></span></span></code></pre></div></div>
<ul>
<li><code>BaseModel</code>: the foundation for defining typed, validated data models.</li>
<li><code>Agent</code>: the main abstraction for running tasks with an LLM.</li>
<li><code>OpenAIChatModel</code>: a wrapper for OpenAI-compatible chat models.</li>
</ul>
<hr>
<h3 id="step-1-define-the-schema">Step 1: Define the Schema</h3>
<p>Pydantic AI uses a dependency injection system to provide data and services to your agent&rsquo;s system prompts, tools, and output validators. Dependencies can be any Python type, and dataclasses are often a convenient container when you need to include multiple objects.</p>
<p>At the same time, by using a schema with Pydantic, we can enforce a variety of validators. This is important because we want the agent&rsquo;s output to always be a structured object. For example, here&rsquo;s a simple schema with two fields:</p>
<div class="code-block code-line-numbers" style="counter-reset: code-block 0">
    <div class="code-header language-python">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CityLocation</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">city</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">country</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Alternatively, using a dataclass:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># from dataclasses import dataclass</span>
</span></span><span class="line"><span class="cl"><span class="c1"># @dataclass</span>
</span></span><span class="line"><span class="cl"><span class="c1"># class CityLocation:</span>
</span></span><span class="line"><span class="cl"><span class="c1">#     city: str</span>
</span></span><span class="line"><span class="cl"><span class="c1">#     country: str</span></span></span></code></pre></div></div>
<p>By defining this schema, we force the model to always return a structured object with two fields: <code>city</code> and <code>country</code>.</p>
<p>Without this, the agent might return a sentence like:</p>
<blockquote>
<p><em>“The 2012 Summer Olympics were held in London, United Kingdom.”</em></p></blockquote>
<p>With this schema, the output is always:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-python">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">CityLocation</span><span class="p">(</span><span class="n">city</span><span class="o">=</span><span class="s2">&#34;London&#34;</span><span class="p">,</span> <span class="n">country</span><span class="o">=</span><span class="s2">&#34;United Kingdom&#34;</span><span class="p">)</span></span></span></code></pre></div></div>
<p>This is <strong>critical for agents</strong> — structured outputs can be passed directly to tools, APIs, or databases without string parsing.</p>
<hr>
<h3 id="step-2-configure-the-model">Step 2: Configure the Model</h3>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-python">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pydantic_ai.providers.ollama</span> <span class="kn">import</span> <span class="n">OllamaProvider</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">model</span> <span class="o">=</span> <span class="n">OpenAIChatModel</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;llama3.1:8b&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">provider</span><span class="o">=</span><span class="n">OllamaProvider</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s1">&#39;http://localhost:11434/v1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span></span></span></code></pre></div></div>
<ul>
<li><code>OpenAIChatModel</code>: wraps the model in an OpenAI-like interface.</li>
<li><code>OllamaProvider</code>: lets us run a local <strong>Llama 3.1</strong> model.</li>
<li>Swap this with <code>&quot;openai:gpt-4o&quot;</code> and you can run against OpenAI&rsquo;s hosted models with no other changes.</li>
</ul>
<p>This flexibility is one of Pydantic AI&rsquo;s strengths.</p>
<hr>
<h3 id="step-3-create-the-agent">Step 3: Create the Agent</h3>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-python">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="p">,</span>   <span class="c1"># or &#34;openai:gpt-4o&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_type</span><span class="o">=</span><span class="n">CityLocation</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span></span></span></code></pre></div></div>
<p>This is the <strong>heart of Pydantic AI</strong>:</p>
<ul>
<li><code>model</code> → the LLM backend.</li>
<li><code>output_type=CityLocation</code> → ensures the output always validates against our schema.</li>
</ul>
<hr>
<h3 id="step-4-run-the-agent">Step 4: Run the Agent</h3>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-python">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="s1">&#39;Where were the olympics held in 2012?&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#&gt; city=&#39;London&#39; country=&#39;United Kingdom&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">usage</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="c1">#&gt; RunUsage(input_tokens=57, output_tokens=8, requests=1)</span></span></span></code></pre></div></div>
<p>When we run the agent:</p>
<ul>
<li>The LLM is called.</li>
<li>The output is validated against <code>CityLocation</code>.</li>
<li>If the model produces something invalid, Pydantic AI automatically <strong>retries</strong> until it fits the schema.</li>
</ul>
<p>We also get detailed <strong>usage stats</strong> (tokens, requests) for cost tracking and monitoring.</p>
<h2 id="introducing-tools">Introducing Tools</h2>
<p>So far, our agent has taken in text and returned structured data. That&rsquo;s powerful, but real-world agents usually need to do things: query a database, call an API, or run some custom Python code.</p>
<p>In Pydantic AI, this is where tools come in. Tools are simply Python functions you expose to the agent. The agent decides when and how to call them.</p>
<p>Let&rsquo;s look at a simple example:</p>
<div class="code-block code-line-numbers" style="counter-reset: code-block 0">
    <div class="code-header language-python">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">random</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pydantic_ai</span> <span class="kn">import</span> <span class="n">Agent</span><span class="p">,</span> <span class="n">RunContext</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Load environment variables from .env</span>
</span></span><span class="line"><span class="cl"><span class="n">load_dotenv</span><span class="p">()</span> <span class="c1"># Load your API Key</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;google-gla:gemini-1.5-flash&#39;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">    <span class="n">deps_type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">    <span class="n">system_prompt</span><span class="o">=</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;You&#39;re a dice game, you should roll the die and see if the number &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;you get back matches the user&#39;s guess. If so, tell them they&#39;re a winner. &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Use the player&#39;s name in the response.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@agent.tool_plain</span>  
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">roll_dice</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Roll a six-sided die and return the result.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@agent.tool</span>  
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_player_name</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">RunContext</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Get the player&#39;s name.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="n">deps</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dice_result</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="s1">&#39;My guess is 4&#39;</span><span class="p">,</span> <span class="n">deps</span><span class="o">=</span><span class="s1">&#39;Anne&#39;</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">dice_result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#&gt; Congratulations Anne, you guessed correctly! You&#39;re a winner!</span></span></span></code></pre></div></div>
<hr>
<h3 id="breaking-it-down">Breaking It Down</h3>
<ol>
<li>
<p><strong>System Prompt</strong>
We set the rules of the game in the <code>system_prompt</code>: the agent must roll a die and check if the result matches the player&rsquo;s guess.</p>
</li>
<li>
<p><strong><code>roll_dice</code> Tool</strong> (<code>@agent.tool_plain</code>)</p>
<ul>
<li>This is a simple tool which requires no extra context from the agent.</li>
<li>It rolls a random number from 1 to 6 and returns it.</li>
<li>The agent can call this function whenever it needs a die result.</li>
</ul>
</li>
<li>
<p><strong><code>get_player_name</code> Tool</strong> (<code>@agent.tool</code>)</p>
<ul>
<li>This tool shows how <strong>dependencies</strong> come into play.</li>
<li>We pass the player&rsquo;s name as a dependency (<code>deps='Anne'</code>).</li>
<li>The tool accesses it through the <code>RunContext</code>.</li>
<li>This is powerful: you can inject things like database connections, API keys, or user profiles in exactly the same way.</li>
</ul>
</li>
<li>
<p><strong>Running the Agent</strong></p>
<ul>
<li>The user says: <em>“My guess is 4.”</em></li>
<li>The agent calls <code>roll_dice</code> to simulate the game.</li>
<li>It calls <code>get_player_name</code> to personalize the response.</li>
<li>Finally, it returns a natural sentence, <em>“Congratulations Anne…”</em></li>
</ul>
</li>
</ol>
<hr>
<h3 id="why-tools-matter">Why Tools Matter</h3>
<p>Tools are what make an agent <strong>actionable</strong>:</p>
<ul>
<li>They let your LLM interact with the real world.</li>
<li>They allow personalization through dependency injection.</li>
<li>They keep logic in Python, not just in prompts.</li>
</ul>
<p>You can test your tools by</p>
<div class="code-block code-line-numbers" style="counter-reset: code-block 0">
    <div class="code-header language-python">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pydantic_ai</span> <span class="kn">import</span> <span class="n">Agent</span><span class="p">,</span> <span class="n">RunContext</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">deps_type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@agent.tool</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">foobar</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">RunContext</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="n">deps</span> <span class="o">+</span> <span class="n">x</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@agent.tool</span><span class="p">(</span><span class="n">retries</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">spam</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">RunContext</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="n">deps</span> <span class="o">+</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="s1">&#39;foobar&#39;</span><span class="p">,</span> <span class="n">deps</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#&gt; {&#34;foobar&#34;:1,&#34;spam&#34;:1.0}</span></span></span></code></pre></div></div>
<ul>
<li>The number of retries to allow for this tool, defaults to the agent&rsquo;s default retries, which defaults to 1.</li>
</ul>
<p>With tools, your agent is no longer just a Q&amp;A bot — it becomes an <strong>active participant</strong> that can call functions, fetch data, and take action.</p>
<h2 id="sre-example">SRE Example</h2>
<p>So far we&rsquo;ve built simple agents that return structured outputs and call a few tools. Let&rsquo;s put everything together in a more realistic scenario: an on-call SRE (Site Reliability Engineering) assistant that analyzes service health and suggests a remediation plan.</p>
<p>Instead of &ldquo;system administrators&rdquo; doing manual firefighting, Google created a team of engineers who used automation, monitoring, and code to manage reliability at scale. That practice evolved into what we now call SRE.</p>
<p>Imagine you&rsquo;re on call. Users report slow responses and 5xx errors. Instead of digging manually through dashboards and logs, you can ask an agent to do the initial triage for you.</p>
<p>Below is a runnable example:</p>
<div class="code-block code-line-numbers" style="counter-reset: code-block 0">
    <div class="code-header language-python">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">asyncio</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Literal</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pydantic_ai</span> <span class="kn">import</span> <span class="n">Agent</span><span class="p">,</span> <span class="n">RunContext</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pydantic_ai.models.openai</span> <span class="kn">import</span> <span class="n">OpenAIChatModel</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pydantic_ai.providers.openai</span> <span class="kn">import</span> <span class="n">OpenAIProvider</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pydantic_ai.providers.ollama</span> <span class="kn">import</span> <span class="n">OllamaProvider</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">load_dotenv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&#34;OPENAI_API_KEY&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ───────────────────────────────</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Mock infra backend</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ───────────────────────────────</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MetricsClient</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">async</span> <span class="k">def</span> <span class="nf">cpu_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">service</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;api&#34;</span><span class="p">:</span> <span class="mf">82.4</span><span class="p">,</span> <span class="s2">&#34;worker&#34;</span><span class="p">:</span> <span class="mf">64.1</span><span class="p">,</span> <span class="s2">&#34;db&#34;</span><span class="p">:</span> <span class="mf">29.8</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">async</span> <span class="k">def</span> <span class="nf">error_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">service</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># errors per minute</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;api&#34;</span><span class="p">:</span> <span class="mf">14.0</span><span class="p">,</span> <span class="s2">&#34;worker&#34;</span><span class="p">:</span> <span class="mf">1.2</span><span class="p">,</span> <span class="s2">&#34;db&#34;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">async</span> <span class="k">def</span> <span class="nf">recent_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">service</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&#34;ERROR&#34;</span><span class="p">,</span> <span class="s2">&#34;WARN&#34;</span><span class="p">],</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="n">logs</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;api&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;[ERROR] upstream timeout /v1/translate (llm gateway)&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;[ERROR] redis timeout queue=llm_jobs&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;[WARN]  slow request /v1/health 1200ms&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;worker&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;[WARN]  retry publish job_id=abc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;[WARN]  prefetch backlog=40&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;db&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;[WARN] connection spike from api&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">logs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="p">[])</span> <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;[</span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2">]&#34;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">out</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ───────────────────────────────</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Dependencies &amp; output schema</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ───────────────────────────────</span>
</span></span><span class="line"><span class="cl"><span class="nd">@dataclass</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">OnCallDeps</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">service</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">metrics</span><span class="p">:</span> <span class="n">MetricsClient</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">RemediationPlan</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&#34;Human-readable summary for the on-call runbook.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">severity</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&#34;SEV1&#34;</span><span class="p">,</span> <span class="s2">&#34;SEV2&#34;</span><span class="p">,</span> <span class="s2">&#34;SEV3&#34;</span><span class="p">,</span> <span class="s2">&#34;INFO&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&#34;Incident severity.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">notify_oncall</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&#34;Page the primary on-call?&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">actions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&#34;Ordered steps to mitigate the issue.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ───────────────────────────────</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Model &amp; Agent</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ───────────────────────────────</span>
</span></span><span class="line"><span class="cl"><span class="c1"># model = OpenAIChatModel(&#34;gpt-4o-mini&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">model</span> <span class="o">=</span> <span class="n">OpenAIChatModel</span><span class="p">(</span><span class="s1">&#39;gpt-5-nano&#39;</span><span class="p">,</span> <span class="n">provider</span><span class="o">=</span><span class="n">OpenAIProvider</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1"># If using Ollama, pick a model that supports tools/function calling, e.g.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># model = OpenAIChatModel(</span>
</span></span><span class="line"><span class="cl"><span class="c1">#     model_name=&#34;qwen3:8b&#34;,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#     provider=OllamaProvider(base_url=&#34;http://localhost:11434/v1&#34;),</span>
</span></span><span class="line"><span class="cl"><span class="c1"># )</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">oncall_agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">deps_type</span><span class="o">=</span><span class="n">OnCallDeps</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_type</span><span class="o">=</span><span class="n">RemediationPlan</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">system_prompt</span><span class="o">=</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;You are an SRE assistant. Diagnose service incidents using tools before concluding. &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Prefer concrete evidence (metrics/logs). Be concise and practical.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Dynamic system prompt: injects service name at runtime</span>
</span></span><span class="line"><span class="cl"><span class="c1"># The !r in an f-string is a conversion flag that tells Python to use the repr() of the value instead of the default str() when formatting.</span>
</span></span><span class="line"><span class="cl"><span class="nd">@oncall_agent.system_prompt</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">service_context</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">RunContext</span><span class="p">[</span><span class="n">OnCallDeps</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;Target service: </span><span class="si">{</span><span class="n">ctx</span><span class="o">.</span><span class="n">deps</span><span class="o">.</span><span class="n">service</span><span class="si">!r}</span><span class="s2">. Environment: production.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ───────────────────────────────</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Tools the agent can call</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ───────────────────────────────</span>
</span></span><span class="line"><span class="cl"><span class="nd">@oncall_agent.tool</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">get_cpu</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">RunContext</span><span class="p">[</span><span class="n">OnCallDeps</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Return current CPU utilization percentage for the target service.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">deps</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">cpu_usage</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">deps</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@oncall_agent.tool</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">get_error_rate</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">RunContext</span><span class="p">[</span><span class="n">OnCallDeps</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Return errors-per-minute for the target service.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">deps</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">error_rate</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">deps</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@oncall_agent.tool</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">get_recent_errors</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">RunContext</span><span class="p">[</span><span class="n">OnCallDeps</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Return recent ERROR logs for the target service.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">deps</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">recent_logs</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">deps</span><span class="o">.</span><span class="n">service</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&#34;ERROR&#34;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@oncall_agent.tool</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">get_recent_warns</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">RunContext</span><span class="p">[</span><span class="n">OnCallDeps</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Return recent WARN logs for the target service.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">deps</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">recent_logs</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">deps</span><span class="o">.</span><span class="n">service</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&#34;WARN&#34;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># (Optional) A “simulated” action tool (no real side-effects here)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@oncall_agent.tool</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">suggest_restart_plan</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">RunContext</span><span class="p">[</span><span class="n">OnCallDeps</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Return a safe, ordered restart plan for the service without executing it.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">svc</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">deps</span><span class="o">.</span><span class="n">service</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="sa">f</span><span class="s2">&#34;Drain traffic from </span><span class="si">{</span><span class="n">svc</span><span class="si">}</span><span class="s2"> (set canary to 0%)&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="sa">f</span><span class="s2">&#34;Restart </span><span class="si">{</span><span class="n">svc</span><span class="si">}</span><span class="s2"> with rolling window=10%, wait=60s&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="sa">f</span><span class="s2">&#34;Warm up cache and check error rate &lt; 2/min&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Restore canary to previous level and monitor 15m&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ───────────────────────────────</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Demo runs</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ───────────────────────────────</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">deps</span> <span class="o">=</span> <span class="n">OnCallDeps</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="s2">&#34;api&#34;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">MetricsClient</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">oncall_agent</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Users report 5xx spikes and slow responses. What&#39;s happening and what should I do?&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">- Please check metrics and logs first.&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">- If CPU and error rate are high, propose a safe mitigation plan.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">deps</span><span class="o">=</span><span class="n">deps</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span></span></span></code></pre></div></div>
<p>Example output:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">message=&#39;High CPU (82%) and error rate (14/min) with upstream/redis timeouts in logs. Likely saturation.&#39;
</span></span><span class="line"><span class="cl">severity=&#39;SEV2&#39;
</span></span><span class="line"><span class="cl">notify_oncall=True
</span></span><span class="line"><span class="cl">actions=[
</span></span><span class="line"><span class="cl">  &#39;Enable rate limiting at API gateway (200 RPS per key)&#39;,
</span></span><span class="line"><span class="cl">  &#39;Scale worker pool +2 replicas; verify queue latency&#39;,
</span></span><span class="line"><span class="cl">  &#39;Apply restart plan (drain -&gt; rolling restart -&gt; warmup -&gt; monitor)&#39;,
</span></span><span class="line"><span class="cl">  &#39;Open an incident channel and post status&#39;
</span></span><span class="line"><span class="cl">]</span></span></code></pre></div></div>
<h4 id="dependencies-injection">Dependencies Injection</h4>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-python">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nd">@dataclass</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">OnCallDeps</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">service</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">metrics</span><span class="p">:</span> <span class="n">MetricsClient</span></span></span></code></pre></div></div>
<ul>
<li><strong>Dependency Injection</strong>: everything the agent needs at runtime (target service + clients).</li>
<li>You pass this as <code>deps=</code> at call time, and the agent receives it via <code>RunContext</code>.</li>
</ul>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-python">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">RemediationPlan</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">message</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">severity</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&#34;SEV1&#34;</span><span class="p">,</span><span class="s2">&#34;SEV2&#34;</span><span class="p">,</span><span class="s2">&#34;SEV3&#34;</span><span class="p">,</span><span class="s2">&#34;INFO&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">notify_oncall</span><span class="p">:</span> <span class="nb">bool</span>
</span></span><span class="line"><span class="cl">    <span class="n">actions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></span></span></code></pre></div></div>
<ul>
<li><strong>Typed, validated output</strong> using Pydantic.</li>
<li>If the LLM returns malformed output, Pydantic AI will <strong>retry</strong> to match this schema—this is what makes agent outputs safe to automate.</li>
</ul>
<h4 id="agent-definition">Agent definition</h4>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-python">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">oncall_agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">deps_type</span><span class="o">=</span><span class="n">OnCallDeps</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_type</span><span class="o">=</span><span class="n">RemediationPlan</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">system_prompt</span><span class="o">=</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;You are an SRE assistant. Diagnose service incidents using tools before concluding. &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Prefer concrete evidence (metrics/logs). Be concise and practical.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span></span></span></code></pre></div></div>
<ul>
<li><code>deps_type</code>: tells Pydantic AI what <code>ctx.deps</code> will look like (type-safe DI).</li>
<li><code>output_type</code>: forces the <strong>final answer</strong> to be a <code>RemediationPlan</code>.</li>
<li><code>system_prompt</code>: a <em>static system prompt</em>. It defines a baseline behavior.</li>
</ul>
<h4 id="dynamic-system-prompt-injection">Dynamic system prompt injection</h4>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-python">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nd">@oncall_agent.system_prompt</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">service_context</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">RunContext</span><span class="p">[</span><span class="n">OnCallDeps</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;Target service: </span><span class="si">{</span><span class="n">ctx</span><span class="o">.</span><span class="n">deps</span><span class="o">.</span><span class="n">service</span><span class="si">!r}</span><span class="s2">. Environment: production.&#34;</span></span></span></code></pre></div></div>
<ul>
<li>Adds <strong>runtime context</strong> to the system prompt (target service/env).</li>
<li><code>!r</code> formats with <code>repr()</code>—handy for quotes and unambiguous display.</li>
</ul>
<h4 id="tools">Tools</h4>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-python">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nd">@oncall_agent.tool</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">get_cpu</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">RunContext</span><span class="p">[</span><span class="n">OnCallDeps</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="nd">@oncall_agent.tool</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">get_error_rate</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">RunContext</span><span class="p">[</span><span class="n">OnCallDeps</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="nd">@oncall_agent.tool</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">get_recent_errors</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">RunContext</span><span class="p">[</span><span class="n">OnCallDeps</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="nd">@oncall_agent.tool</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">suggest_restart_plan</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">RunContext</span><span class="p">[</span><span class="n">OnCallDeps</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span> <span class="o">...</span></span></span></code></pre></div></div>
<ul>
<li>
<p>Each tool is a <strong>callable capability</strong> exposed to the agent.</p>
</li>
<li>
<p>The model decides <strong>when</strong> to call them (tool-use planning) based on your prompt.</p>
</li>
<li>
<p>You’ve got:</p>
<ul>
<li><strong>Read tools</strong>: CPU, error rate, recent error logs.</li>
<li><strong>Advisory tool</strong>: return a step-by-step restart plan (no side effects—great for tutorials).</li>
</ul>
</li>
</ul>
<blockquote>
<p>Tip: If you later add a <em>real</em> action (e.g., scale/rollback), guard it with a <code>dry_run</code> flag in <code>deps</code> until you add approvals.</p></blockquote>
<h4 id="running-the-agent">Running the agent</h4>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-python">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">deps</span> <span class="o">=</span> <span class="n">OnCallDeps</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="s2">&#34;api&#34;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">MetricsClient</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">oncall_agent</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Users report 5xx spikes and slow responses. What’s happening and what should I do?</span><span class="se">\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;- Please check metrics and logs first.</span><span class="se">\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;- If CPU and error rate are high, propose a safe mitigation plan.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">deps</span><span class="o">=</span><span class="n">deps</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span></span></span></code></pre></div></div>
<ul>
<li>
<p>Execution flow:</p>
<ol>
<li>Agent builds the <strong>full system prompt</strong> = base + <code>service_context(...)</code>.</li>
<li>Model <strong>plans tool calls</strong> (fetch CPU, error rate, logs).</li>
<li>Model <strong>reasons</strong> over tool results.</li>
<li>Pydantic AI <strong>validates</strong> the model’s draft into <code>RemediationPlan</code>. If invalid, it <strong>retries</strong>.</li>
<li>You get a <strong>typed object</strong> you can send to a runbook, Slack, PagerDuty, etc.</li>
</ol>
</li>
</ul>
<h2 id="references">References</h2>
<ul>
<li><a href="https://ai.pydantic.dev/" target="_blank" rel="noopener noreffer ">Pydantic AI</a></li>
</ul>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2025-09-02&nbsp;<a class="git-hash" href="https://github.com/Han8931/commit/c650dd06a07fcbc96822f10e7c17f6f431ab268a" target="_blank" title="commit by Han(tabularasa8931@gmail.com) c650dd06a07fcbc96822f10e7c17f6f431ab268a: Update">
                                    <i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>c650dd0</a></span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/pydantic-ai/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/python/">Python</a>,&nbsp;<a href="/tags/pydantic/">Pydantic</a>,&nbsp;<a href="/tags/pydantic-ai/">Pydantic-AI</a>,&nbsp;<a href="/tags/agent/">Agent</a>,&nbsp;<a href="/tags/ai/">AI</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/pydantic/" class="prev" rel="prev" title="Clean Validation with Pydantic v2"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Clean Validation with Pydantic v2</a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.148.2">Hugo</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2024 - 2025</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Han</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a>
        </div>

        <div id="fixed-buttons-hidden"><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><script src="/lib/autocomplete/autocomplete.min.js"></script><script src="/lib/algoliasearch/lite/browser.umd.js"></script><script src="/lib/lazysizes/lazysizes.min.js"></script><script src="/lib/clipboard/clipboard.min.js"></script><script src="/lib/katex/katex.min.js"></script><script src="/lib/katex/contrib/auto-render.min.js"></script><script src="/lib/katex/contrib/copy-tex.min.js"></script><script src="/lib/katex/contrib/mhchem.min.js"></script><script>window.config={"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"algoliaAppID":"A9NUSQZEO5","algoliaIndex":"github","algoliaSearchKey":"e255482bc340762a0da27f50eddd2765","highlightTag":"em","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"algolia"}};</script><script src="/js/theme.min.js"></script></body>
</html>
